{% extends "base.html" %}
<head>
    {% block head %}
    {{ super() }}

    <script>
        // Ajax를 사용해 postContent() 함수를 완성하세요.
        function postContent() {
            let content = $("#my-content").val()
            let user_id = `{{g.user.user_id}}`
            
            $.ajax({
                url: '/post',
                type: 'post',
                data: {
                        'content': content,
                        'user_id': user_id
                },
                success: function (res) {
                        let result = res['result']
                        if (result == "success") {
                                alert("댓글을 달았습니다!")
                                window.location.reload()
                        } else {
                                alert("저장에 실패 했습니다!")
                        }
                }
        })
        }
    
        function deletePost(id) {
            alert("delete!")
        }
        function postUpdatePost(id) {
            alert("update!")
        }
        function updatePost(id) {
            alert("update!")
        }
    </script>
    {% endblock %}
</head>

<body>
    {% block nav %}
    {% for d in data %}
        <div class='book_detail'>
            <h2>{{d.book_name}}</h2>
            <img id="imgs" src="{{ url_for('static', filename='{}'.format(img_url)) }}">
            <p>작가: {{d.author}}</p>
            <p>출판사: {{d.publisher}}</p>
            <p>출판날짜: {{d.publication_date}}</p>
            <p>페이지: {{d.pages}}</p>
            <p class="description">상세설명: {{d.description}}</p>
            <p>링크: {{d.link}}</p>
            <p>재고: {{d.inventory}}</p>
        </div>
    {% endfor %}
    
    <hr>
    <h2 class='book_detail'>평점 및 후기</h2>
    
    <div class='book_detail'>
        
        <div>
            {% if not session['login'] %}
                <div>
                    <p>로그인 후 댓글 쓰기가 가능합니다.</p>
                </div>
            {% else %}
                <div>
                    <h4>{{g.user.user_id}}님, 후기를 남겨주세요!</h4>
                    <textarea id='my-content' rows="3" cols='100'></textarea>
                </div>
                <button onclick="postContent()">작성하기</button>
            {% endif %}
        </div>
    </div>
    <hr>
    {% for post in post_list %}
    <div class="book_detail">
        <div >
            <div >
                <label class="form-label">{{post.user_id}}</label>
                <div id='edit-area'>
                    <p id='userContent{{post.id}}'>{{post.content}}</p>
                </div>
            </div>
            {{post.time}}
        </div>


        <div class="card-footer text-muted">
            <button class="btn btn-sm btn-warning" onclick="deletePost('{{post.index}}')">삭제하기</button>
            <button id='editBtn{{post.index}}' class="btn btn-sm btn-success" onclick="updatePost('{{post.index}}')">수정하기</button>
        </div>
        
    </div>    
    {% endfor %}

    {% endblock %}
</body>